
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>视频控件</title>
    <style>
        body {font-family:"", arial;margin:0 auto; padding:0; }
        div,form,img,ul,p {margin: 0 auto; padding: 0; border: 0; overflow:hidden; list-style-type:none; }
        h1,h2,h3,h4,h5,h6 { margin:0; padding:0;}
        .bigbg{
            width:1280px;
            height:820px;
            position:relative;
            /*top:50px;*/
            background:#fff;
            margin-left: 0;
        }

        .kuang{
            background:url(img/video_03.gif) no-repeat;
            /*width:1280px;*/
            /*height:820px;*/
            /*margin-top:12px;*/
        }

        .close a{
            background:url(img/1_04.gif) no-repeat;
            width:41px;
            height:36px;
            position:absolute;
            left:618px;
            top:5px;
        }
        .close a:hover{
            background:url(img/2_04.gif) no-repeat;
            with:41px;
            height:36px;
            position:absolute;
            left:618px;
            top:5px;
        }

        .videoscreen{
            /*width:1280px;*/
            /*height:720px;*/
            background-color:#999;
            position:absolute;
            left:0px;
            top:0px;
        }

        .sfream {
            background:url(img/video_05.jpg) no-repeat;
            width:627px;
            height:42px;
            margin-top:400px;}

        .play a{
            background:url(img/video_25.gif) no-repeat;
            width:19px;
            height:19px;
            position:absolute;
            left:26px;
            bottom:17px;}

        .pause a{	background:url(img/video_26.gif) no-repeat;
            width:21px;
            height:19px;
            position:absolute;
            left:46px;
            bottom:17px;
        }
        .progressbar a{	background:url(img/video_28.gif) no-repeat;
            width:291px;
            height:20px;
            position:absolute;
            left:76px;
            bottom:17px;
        }
        .snapshot-picture a{	background:url(img/video_16.gif) no-repeat;
            width:25px;
            height:25px;
            position:absolute;
            left:377px;
            bottom:17px;}

        .stepback a {	background:url(img/video_18.gif) no-repeat;
            width:24px;
            height:25px;
            position:absolute;
            left:409px;
            bottom:17px;}

        .camera a{background:url(img/video_20.gif) no-repeat;
            width:26px;
            height:27px;
            position:absolute;
            left:439px;
            bottom:14px;}

        .stopcamera a{background:url(img/video_22.gif) no-repeat;
            width:27px;
            height:27px;
            position:absolute;
            left:472px;
            bottom:14px;}

        .singlescreen a{background:url(img/video_09.gif) no-repeat;
            width:31px;
            height:29px;
            position:absolute;
            left:506px;
            bottom:12px;}

        .doublescreen a{background:url(img/video_11.gif) no-repeat;
            width:31px;
            height:29px;
            position:absolute;
            left:546px;
            bottom:12px;}

        .ninescreen a{background:url(img/video_13.gif) no-repeat;
            width:32px;
            height:29px;
            position:absolute;
            left:586px;
            bottom:12px;}

        .ninescreen a:hover{background:url(img/design_05.gif) no-repeat;
            width:40px;
            height:29px;
            position:absolute;
            left:586px;
            bottom:82px;}

    </style>


</head>

<body>

<div class="bigbg">
    <div class="kuang">
        <div class="videoscreen">



                <!--<object classid="clsid:30209FBC-57EB-4F87-BF3E-740E3D8019D2" codebase=""-->
                        <!--standby="Waiting..." id="playOcx" width="1280" height="720" name="playOcx" align="center" >-->
                    <!--<embed width="618" height="360" align="center"></embed>-->

                <!--</object>-->

                <object classid="clsid:30209FBC-57EB-4F87-BF3E-740E3D8019D2" codebase=""
                        standby="Waiting..." id="playOcx" width="640" height="360" name="playOcx" align="center" >
                    <embed width="618" height="360" align="center"></embed>

                </object>


        </div>

        <div class="sfream" style="display: none">
            <div class="play"><a href="javascript:StartPreview()">播放</a><br/></div>
            <div class="pause"><a href="javascript:StoptPreview()">暂停</a><br /></div>
            <div class="progressbar"><a href=""></a></div>
            <div class="snapshot-picture"><a href="javascript:Capture()">拍照</a><br/></div>
            <div class="stepback"><a href=""></a></div>
            <div class="camera"><a href="javascript:StartRecord()">录制</a><br/></div>
            <div class="stopcamera"><a href="javascript:StopRecord()">停止录制</a></div>
            <div class="singlescreen"><a href=""></a></div>
            <div class="doublescreen"><a href=""></a></div>
            <div class="ninescreen"><a href=""></a></div>
        </div>
    </div>
    <div class="close"><a href=""></a></div>

</div>

<script src="../../../assets/global/plugins/respond.min.js"></script>
<script src="../../../assets/global/plugins/excanvas.min.js"></script>
<!--<![endif]&ndash;&gt;-->
<script src="../../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="../../../assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="../../../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>

<!-- END CORE PLUGINS -->
<script rel="stylesheet" src="../bank-resource/js/lib/jquery.dataTables.min.js"></script>
<script src="../../../assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="../../../assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="../../../assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="../../../assets/local/scripts/BEE.js"></script>
<script src="../resource/zTree_v3-master/js/jquery.ztree.all.js"></script>
<script src="../resource/zTree_v3-master/js/jquery.ztree.exhide.js"></script>
<!--非框架中的js-->
<script src="../bank-branch-resource/js/lib/bootstrap-datepicker.js"></script>
<script src="../bank-branch-resource/js/lib/moment.min.js"></script>
<script src="../bank-resource/js/lib/html2canvas.js"></script>
<script src="../bank-resource/js/lib/jspdf.debug.js"></script>
<script src="../resource/js/echarts.min.js"></script>
<!--<script src="monitorSrc/jquery-1.7.1.min.js"></script>-->
<script src="../../../assets/local/configs/setNames.js"></script>
<script src="../../../assets/local/scripts/Went.utility.js"></script>

<script>

    jQuery(document).ready(function() {
        Metronic.init(); // init metronic core components
        BEE.init(true);
        Layout.init(); // init current layout
        Demo.init(); // init demo features
    });

    setTimeout(function(){

        //开始预览
        getAlarmCameraData();

    },100);

    //获取宽度
    var  curWidth =  window.location.href.split("width=")[1].split("height=")[0];

    //获取屏幕高度
    var curHeight =  window.location.href.split("height=")[1].split("cameraID=")[0];

    curWidth = parseInt(curWidth);

    curHeight = parseInt(curHeight);

    $('#playOcx').attr('width',curWidth);

    $('#playOcx').attr('height',curHeight);


    //获取当前摄像头报警数据
    function getAlarmCameraData(){

        //获取当前摄像头ID
        var cameraID = window.location.href.split("cameraID=")[1];

        $.ajax({
            type:'get',
            url:sessionStorage.apiUrlPrefix + 'Alarm/GetCameraDataByID',
            data:{
                "cameraID":cameraID
            },
            success:function(result){

                //console.log(result);

                //登陆当前摄像头

                //账号
                var account = result.mappVideoRecorder.f_User;
                //地址
                var address = result.mappVideoRecorder.f_RecIP;
                //密码
                var password = result.mappVideoRecorder.f_Password;

                var ifdecode = getDataByConfig();

                //判断是否需要解密
                if( ifdecode== 1){

                    //给密码解密
                    password = Went.utility.wCoder.wDecode(password,"");

                }

                //端口
                var port = result.mappVideoRecorder.f_PortNum;

                //通道号
                var aisleNum = result.f_AisleNum;

                //console.log(password);

                //登录当前设备
                StartPreview(account,address,password,port,aisleNum);

            },
            error:function(){

            }
        })

    };

    function StartPreview(account,address,password,port,aisleNum)
    {
        //alert("开始");
        var SSOcx = document.getElementById("playOcx");
        SSOcx.SetDeviceInfo(address,port,aisleNum,account,password);
        SSOcx.StartPlay();

    }


    //从配置项中获取页面中所需信息
    function getDataByConfig(){


        var ifdecode = 0;

        //获取当前页面的配置信息
        $(__systemConfigArr).each(function(i,o){

            //console.log(o);

            //获取当前配置项中的url
            if(o.pageId == 0){

                ifdecode = o.ifdecode;
            }
        });

        return ifdecode;

    };


    function StoptPreview()
    {
        var SSOcx = document.getElementById("playOcx");
        SSOcx.StopPlay();

    }

    function Capture()
    {

        var SSOcx = document.getElementById("playOcx");
        var dd= SSOcx.GetCapturePicture("d:\\1.bmp");

    }

    function StartRecord()
    {

        var SSOcx = document.getElementById("playOcx");
        SSOcx.SaveRealData("d:\\1.avi");
    }

    function StopRecord()
    {
        var SSOcx = document.getElementById("playOcx");
        SSOcx.StopSaveRealDate();
    }

    /**
     * 检测浏览器是否存在视频插件
     * @return {Boolean}
     */
    function checkPlugins() {
        var result;
        if (Sys.ie) {
            try {
                result = new ActiveXObject(PLUGINS_NAME);
                delete result;
            } catch (e) {
                return false;
            }
            return true;
        } else {
            navigator.plugins.refresh(false);
            result = navigator.mimeTypes["application/media-plugin-version-3.1.0.2"];
            return !!(result && result.enabledPlugin);
        }
    }

</script>

</body>
</html>
