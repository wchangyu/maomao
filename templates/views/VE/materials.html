<!-- 系统教学 >> 学习资料 materials -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>重庆大学虚拟实验室</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <script src="../resource/js/jquery-1.11.2.js"></script>
    <script src="../resource/js/moment.js"></script>
    <script src="../resource/js/showOrHidden.js"></script>
    <link rel="stylesheet" href="../resource/css/leftBat.css">
    <link rel="stylesheet" href="../resource/TableTools/button/dataTables.tableTools.css">
    <link rel="stylesheet" href="../resource/TableTools/button/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../resource/TableTools/button/buttons.dataTables.min.css">
    <link rel="stylesheet" href="../resource/css/css/systemHomePage.css">
    <link href="../../../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link id="style_color" href="../../../assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="../favicon.ico" />
</head>
<body class="page-header-fixed page-quick-sidebar-over-content">
    <div class="page-header navbar navbar-fixed-top">
        <div class="page-header-inner">
            <div class="page-logo">
                <a href="../shouye/index.html">
                    <!--重庆大学LOGO-->
                    <img src="../../../assets/local/img/hq3-small.png" alt="logo" class="logo-default" />
                </a>
                <div class="menu-toggler sidebar-toggler hide">

                </div>
            </div>
            <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
            </a>
            <div class="totalTitle"></div>
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    <!--登录日期-->
                    <li style="color:#ccc;line-height:46px;margin-right:20px;font-size:14px;">
                        <span id="loginDT" style="font-weight:900;">2017年11月27日</span>
                        <span id="loginWk" style="font-weight:900;">星期一</span>
                    </li>
                    <!--角色名称-->
                    <li style="color:#ccc;line-height:46px;margin-right:10px;font-size:14px;">
                        <span id="roleNT" style="font-weight:900;">学生</span>
                    </li>
                    <!--登录用户-->
                    <li class="dropdown dropdown-user">
                        <a href="javascript:;" class="dropdown-toggle" style="background-color:rgba(0,0,0,0);"
                           data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                            <img alt="" class="img-circle" src="assets/imgs/usericon.png" style="width:25px;height:25px;" />
                            <div class="username username-hide-on-mobile" style="display:inline-block !important;color:#ccc;font-weight:900;">
                                <!--<span id="sysuserNT" style="color:#ccc;font-weight:900;">MRF</span>-->
                            </div>
                            <i class="fa fa-angle-down"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-default" style="max-width:150px;">
                            <li>
                                <a id="lgot" href="javascript:;">
                                    <i class="icon-key"></i> 退出登录
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="clearfix">
    </div>
    <div class="page-container">
        <div class="page-sidebar-wrapper">
            <div class="page-sidebar navbar-collapse collapse">
                <ul class="page-sidebar-menu" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
                    <li class="sidebar-toggler-wrapper">
                        <div class="sidebar-toggler">
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="page-content-wrapper">
            <div class="page-content">
                <div class="theme-panel hidden-xs hidden-sm">
                    <div class="toggler">
                    </div>
                    <div class="toggler-close">
                    </div>
                    <div class="theme-options">
                        <div class="theme-option theme-colors clearfix">
                            <span>
                                配色
                            </span>
                            <ul>
                                <li class="color-default current tooltips" data-style="default" data-container="body" data-original-title="默认">
                                </li>
                                <li class="color-darkblue tooltips" data-style="darkblue" data-container="body" data-original-title="蓝黑">
                                </li>
                                <li class="color-blue tooltips" data-style="blue" data-container="body" data-original-title="蓝色">
                                </li>
                                <li class="color-grey tooltips" data-style="grey" data-container="body" data-original-title="灰色">
                                </li>
                            </ul>
                        </div>
                        <div class="theme-option">
                            <span>
                                布局
                            </span>
                            <select class="layout-option form-control input-sm">
                                <option value="fluid" selected="selected">平铺</option>
                                <option value="boxed">盒式</option>
                            </select>
                        </div>
                        <div class="theme-option">
                            <span>
                                侧边菜单
                            </span>
                            <select class="sidebar-menu-option form-control input-sm">
                                <option value="accordion" selected="selected">手风琴式</option>
                                <option value="hover">鼠标悬停</option>
                            </select>
                        </div>
                        <div class="theme-option">
                            <span>
                                侧边位置
                            </span>
                            <select class="sidebar-pos-option form-control input-sm">
                                <option value="left" selected="selected">左</option>
                                <option value="right">右</option>
                            </select>
                        </div>
                        <div class="theme-option">
                            <span>
                                底部
                            </span>
                            <select class="page-footer-option form-control input-sm">
                                <option value="fixed">位置固定</option>
                                <option value="default" selected="selected">默认</option>
                            </select>
                        </div>
                    </div>
                </div>
                <h3 class="page-title"></h3>
                <div class="page-bar">
                    <ul class="page-breadcrumb">
                        <li>
                            <i class="fa fa-home"></i>
                            <i class="fa fa-angle-right"></i>
                        </li>
                    </ul>
                    <div class="page-toolbar">
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="row margin-top-10">
                    <div class="col-md-12 col-xs-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <div class="portlet-input">
                                        <div class="input-icon right">
                                            <div style="float:left;">
                                                <input id="keyWord" type="text" class="form-control input-circle" placeholder="资料关键字搜索">
                                            </div>
                                            <a class="btn btn-sm" style="margin-left:-34px;line-height:24px;">
                                                <i class="fa fa-search"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="actions">
                                    <a id="openModalBtn" class="btn btn-sm green">
                                        管理资料
                                    </a>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <table id="oTable" class="table table-striped table-bordered table-advance table-hover">
                                    <thead>
                                        <tr>
                                            <th>标题名称</th>
                                            <th>作者</th>
                                            <th>来源</th>
                                            <th>发表时间</th>
                                            <th>上传者</th>
                                            <th>下载次数</th>
                                            <th>下载</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
        <a href="javascript:;" class="page-quick-sidebar-toggler"><i class="icon-close"></i></a>
    </div>
    <div class="page-footer">
        <div class="page-footer-inner">
            2016 &copy; Huaqin.
        </div>
        <div class="scroll-to-top">
            <i class="icon-arrow-up"></i>
        </div>
    </div>
    <!--MODAL(资料管理)-->
    <div class="modal fade" id="MaterialModalBox" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="material-form" method="post">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title">
                            资料管理上传
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-danger display-hide">
                            <button class="close" data-close="alert"></button>
                            <span id="alertText">
                                请输入标题、作者、来源和选择资料
                            </span>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <input class="form-control placeholder-no-fix"
                                       type="text" autocomplete="off"
                                       placeholder="资料标题(必填)"
                                       name="materialTitle"
                                       style="padding-left:12px !important;" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <input class="form-control placeholder-no-fix"
                                       type="text" autocomplete="off"
                                       placeholder="资料作者(必填)"
                                       name="materialAuthor"
                                       style="padding-left:12px !important;" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <input class="form-control placeholder-no-fix"
                                       type="text" autocomplete="off"
                                       placeholder="资料来源(必填)"
                                       name="materialFrom"
                                       style="padding-left:12px !important;" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <div class="input-group date form_date MATERIALDT">
                                    <input id="materialTime"
                                           name="materialTime"
                                           placeholder="发表时间(必填)"
                                           class="form-control"
                                           size="16" type="text" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <input name="materialFile" type="file"
                                       style="padding-left:0px !important;" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-icon">
                                <input class="form-control placeholder-no-fix"
                                       type="text" autocomplete="off"
                                       placeholder="描述"
                                       name="materialMemo"
                                       style="padding-left:12px !important;" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="closeModalBtn" type="button" class="btn btn-default">
                            关闭
                        </button>
                        <button id="saveMaterialBtn" type="submit" class="btn btn-primary">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="../../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/scripts/metronic.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
    <script src="../../../assets/echarts/echarts.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/moment.min.js" type="text/javascript"></script>
    <script src="../resource/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.js" type="text/javascript"></script>
    <script src="../resource/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    <script src="../resource/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
    <script src="../../../assets/local/scripts/BEE.js"></script>
    <script src="../VE/assets/scripts/VE.js"></script>
    <!--GLOBAL-->
    <script>
        jQuery(document).ready(function () {
            Metronic.init();
            Layout.init();
            Demo.init();
            BEE.init();
            VE.init();
        });
    </script>
    <!--权限管理-->
    <script type="text/javascript">
        $(document).ready(function () {
            sessionStorage.userRole = "1";
            if (sessionStorage.userRole === "1") {
                $('#openModalBtn').show();
                $('#saveMaterialBtn').show();
            } else {
                $('#openModalBtn').hide();
                $('#saveMaterialBtn').hide();
            }
        });
    </script>
    <!--资料管理-->
    <script type="text/javascript">
        function INITDT() {
            var now = new Date();
            var now_year = now.getFullYear();
            var now_month = now.getMonth() + 1;
            var now_day = now.getDate();
            var now_dstr = now_year + "-" + VE.addZeroToSingleNumber(now_month) + "-" + VE.addZeroToSingleNumber(now_day);
            var mot = moment(now_dstr);
            var nowDt = mot.subtract(180, 'days').format('YYYY-MM-DD');
            $('.MATERIALDT').datetimepicker({
                format: 'yyyy-mm-dd',
                language: 'zh-CN',
                weekStart: true,
                todayBtn: true,
                autoclose: true,
                todayHighlight: true,
                startView: 2,
                minView: 2,
                minuteStep: 10,
                forceParse: 0,
                pickerPosition: "bottom-left"
            });
        }
        $(document).ready(function () {
            INITDT();
            //打开MODALBOX
            $('#openModalBtn').on('click', function () {
                $('#MaterialModalBox').modal('show')
            });
            //关闭MODALBOX
            $('#closeModalBtn').on('click', function () {
                $('#MaterialModalBox').modal('hide')
            });
            //FILE事件
            $(':file').change(function () {
                var file = this.files[0];
                var name = file.name;
                var size = file.size;
                var type = file.type;
            });
            //上传资料
            $('.material-form').validate({
                errorElement: 'span',
                errorClass: 'help-block',
                focusInvalid: false,
                rules: {
                    materialTitle: {
                        required: true
                    },
                    materialAuthor: {
                        required: true
                    },
                    materialFrom: {
                        required: true
                    },
                    materialTime: {
                        required: true,
                        date: true
                    },
                    materialFile: {
                        required: true
                    }
                },
                messages: {
                    materialTitle: {
                        required: "资料标题是必填字段."
                    },
                    materialAuthor: {
                        required: "资料作者是必填字段"
                    },
                    materialFrom: {
                        required: "资料来源是必填字段"
                    },
                    materialTime: {
                        required: "资料发表时间是必填字段",
                        date: "资料发表时间格式不正确"
                    },
                    materialFile: {
                        required: "资料文件是必填字段"
                    }
                },
                invalidHandler: function (event, validator) {
                    $('.alert-danger', $('.material-form')).show();
                },
                highlight: function (element) {
                    $(element)
	                    .closest('.form-group').addClass('has-error');
                },
                success: function (label) {
                    label.closest('.form-group').removeClass('has-error');
                    label.remove();
                },
                errorPlacement: function (error, element) {
                    error.insertAfter(element.closest('.input-icon'));
                },
                submitHandler: function (form) {
                    if (sessionStorage.userRole === "2") {
                        $('.alert-danger', $('.material-form')).show();
                    } else {
                        $('#saveMaterialBtn').attr('disabled', 'disabled');
                        $('#saveMaterialBtn').html('正在保存...');
                        var pushUrl = "Materials/PushMaterials";
                        $.post(pushUrl, {
                            MaterialTitle: $('#MaterialTitle').val(),
                            MaterialAuthor: $('#MaterialAuthor').val(),
                            MaterialFrom: $('#MaterialFrom').val(),
                            MaterialFile: $('#MaterialFile').val(),
                            MaterialTime: $('#MaterialTime').val(),
                            Topics: sessionStorage.topicsType,//课题
                            UploadUserID: sessionStorage.userName,
                            Memo: $('#materialMemo').val()
                        }, function (res) {
                            if (res === 99) {
                                $('#MaterialModalBox').modal('hide')
                                getMaterials();
                            } else {
                                alert('抱歉。资料管理上传失败。');
                                $('#saveMaterialBtn').removeAttr('disabled');
                                $('#saveMaterialBtn').html('保存');
                            }
                        });
                    }
                }
            });
        });
    </script>
    <!--资料数据-->
    <script type="text/javascript">
        var oTable = null;
        $(document).ready(function () {
            getMaterials();
        });
        function getMaterials() {
            var url = "Materials/GetMaterials"
                + "?keyWord=" + encodeURIComponent($('#keyWord').val())
                + "&Topics=" + sessionStorage.topicsType
                + "&r=" + Math.random();
            $.get(url, function (res) {
                //标题名称、作者、来源、发表时间、上传者、下载次数、下载操作
                var dataArr = [];
                for (var i = 0; i < res.length; i++) {
                    var arr = [];
                    arr.push(res[i].MaterialTitle);
                    arr.push(res[i].MaterialAuthor);
                    arr.push(res[i].MaterialFrom);
                    arr.push(res[i].MaterialTime);
                    arr.push(res[i].UploadUserName);
                    arr.push(res[i].DownMaterialsNumber);
                    dataArr.push(arr);
                }
                if (oTable === null) {
                    oTable = $("#oTable").dataTable({
                        "iDisplayLength": 25,
                        "bFilter": false,
                        "bLengthChange": false,
                        "autoWidth": true,  //用来启用或禁用自动列的宽度计算
                        "paging": false,   //是否分页
                        "destroy": true,//还原初始化了的datatable
                        "searching": false,
                        "paging": true,
                        "searching": false,
                        "ordering": false,
                        "bFilter": false,
                        "bPaginate": true, //翻页功能
                        "bSort": false,
                        "bProcessing": false,
                        "destroy": true,
                        "sPaginationType": "bootstrap", //分页样式
                        "oLanguage": {
                            "sLengthMenu": "每页显示 _MENU_ 条记录",
                            "sZeroRecords": "没有任何学习资料数据",
                            "sEmptyTable": "没有任何学习资料数据",
                            "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                            "sInfoFiltered": "数据表中共为 _MAX_ 条记录",
                            "sInfoEmpty": "",
                            "sSearch": "搜索",
                            "oPaginate": {
                                "sFirst": "首页",
                                "sPrevious": "上一页",
                                "sNext": "下一页",
                                "sLast": "末页"
                            },
                        },
                        "aoColumns": [{
                            "fnRender": function (oObj) {
                                return oObj.aData[0];//标题名称
                            }
                        }, {
                            "fnRender": function (oObj) {
                                return oObj.aData[1];//资料作者
                            }
                        },
                        {
                            "fnRender": function (oObj) {
                                return oObj.aData[1];//资料来源
                            }
                        }, {
                            "fnRender": function (oObj) {
                                return oObj.aData[1];//发表时间
                            }
                        }, {
                            "fnRender": function (oObj) {
                                return oObj.aData[1];//上传者
                            }
                        }, {
                            "fnRender": function (oObj) {
                                return oObj.aData[1];//下载次数
                            }
                        }, {
                            "fnRender": function (oObj) {
                                return '<a class="btn btn-default green">下载资料</a>';
                            }
                        }]
                    });
                }
                //清空一下table
                oTable.fnClearTable();
                //想表格中添加东西数据
                if (dataArr.length > 0) {
                    oTable.fnAddData(dataArr);
                }
                //重绘表格
                oTable.fnDraw();
                $('.dataTables_info').hide();
                $('.dataTables_paginate').hide();
            });
        }
    </script>
</body>
</html>