<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>重庆大学虚拟实验室</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="../../../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/select2/select2.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/pages/css/login-soft.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="../bank-resource/data-tables/DT_bootstrap.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../favicon.ico" />
</head>
<body class="page-quick-sidebar-over-content">
    <div class="page-container">
        <div class="page-content-wrapper">
            <div class="portlet light bg-inverse">
                <div class="portlet-body full-height-content">
                    <h3 style="text-align:center;">班级管理</h3>
                    <hr />
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div>
                                <select id="departType" name="departType" class="select2 form-control"
                                        style="margin-top:10px;width:200px;float:left;margin-right:10px;">
                                </select>
                                <input class="form-control placeholder-no-fix" 
                                       style="margin-top:10px;width:200px;float:left;margin-right:10px;"
                                       type="text" placeholder="输入班级名称" id="className" name="className" />   
                                <a id="save-class-btn" class="btn btn-default green" 
                                   style="margin-top:11px;border:0px solid green;">
                                    保存
                                </a>                         
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                    </div>
                    <div class="row margin-top-20">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <table id="oTable" class="table table-striped table-bordered table-advance table-hover">
                                <thead>
                                    <tr>
                                        <th>院系序号</th>
                                        <th>院系名称</th>
                                        <th>班级序号</th>
                                        <th>班级名称</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/backstretch/jquery.backstretch.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/select2/select2.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/scripts/metronic.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
    <script src="../bank-resource/data-tables/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="../bank-resource/data-tables/DT_bootstrap.js" type="text/javascript"></script>
    <!--GLOBAL-->
    <script>
        jQuery(document).ready(function () {
            Metronic.init();
            Layout.init();
        });
    </script>
    <script type="text/javascript">

        var oTable = null;

        //获取院系数据
        function departs() {
            var departUrl = "/Depart/GetDepartDs?r=" + Math.random();
            $.get(departUrl, function (res) {
                $('#departType').html();
                $('#departType').find('option').remove();
                $('#departType').empty();
                for (var i = 0; i < res.length; i++) {
                    var ID = res[i].ID;
                    var Name = res[i].Name;
                    $('#departType').append($("<option value=\"" + ID + "\">" + Name + "</option>"));
                }
                if (res.length > 0) {
                    $('#departType option:eq(0)').attr('selected', 'selected');
                }
            });
        }

        //获取班级数据
        function classDs() {
            var classUrl = "/Class/GetClassDs?r=" + Math.random();
            $.get(classUrl, function (res) {
                INITDATATABLE(res);
            });
        }

        function INITDATATABLE(res) {
            var dataArr = [];
            for (var i = 0; i < res.length; i++) {
                var arr = [];
                arr.push(res[i].DepartID);
                arr.push(res[i].DepartName);
                arr.push(res[i].ID);
                arr.push(res[i].Name);
                dataArr.push(arr);
            }
            if (oTable === null) {
                oTable = $("#oTable").dataTable({
                    "iDisplayLength": 25,
                    "bFilter": false,
                    "bLengthChange": false,
                    "autoWidth": true,  //用来启用或禁用自动列的宽度计算
                    "paging": false,   //是否分页
                    "destroy": true,//还原初始化了的datatable
                    "searching": false,
                    "paging": true,
                    "searching": false,
                    "ordering": false,
                    "bFilter": false,
                    "bPaginate": true, //翻页功能
                    "bSort": false,
                    "bProcessing": false,
                    "destroy": true,
                    "sPaginationType": "bootstrap", //分页样式
                    "oLanguage": {
                        "sLengthMenu": "每页显示 _MENU_ 条记录",
                        "sZeroRecords": "没有任何班级数据",
                        "sEmptyTable": "没有任何班级数据",
                        "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                        "sInfoFiltered": "数据表中共为 _MAX_ 条记录",
                        "sInfoEmpty": "",
                        "sSearch": "搜索",
                        "oPaginate": {
                            "sFirst": "首页",
                            "sPrevious": "上一页",
                            "sNext": "下一页",
                            "sLast": "末页"
                        },
                    },
                    "aoColumns": [{
                        "fnRender": function (oObj) {
                            return oObj.aData[0];//院系ID
                        }
                    }, {
                        "fnRender": function (oObj) {
                            return oObj.aData[1];//院系名称
                        }
                    }, {
                        "fnRender": function (oObj) {
                            return oObj.aData[2];//班级ID
                        }
                    }, {
                        "fnRender": function (oObj) {
                            return oObj.aData[3];//班级名称
                        }
                    }]
                });
            }
            //清空一下table
            oTable.fnClearTable();
            //想表格中添加东西数据
            if (dataArr.length > 0) {
                oTable.fnAddData(dataArr);
            }
            //重绘表格
            oTable.fnDraw();
            $('.dataTables_info').hide();
            $('.dataTables_paginate').hide();
        }

        $(document).ready(function () {

            //获取院系数据
            departs();

            //保存班级信息
            $('#save-class-btn').on('click', function () {
                var className = $('#className').val();
                var departId = $('#departType').val();
                if(departId.length===0){
                    alert('请先选择院系.');
                } else if (className.length === 0) {
                    alert('班级名称为必填字段.');
                } else {
                    var pushUrl = "/Class/PushClass";
                    $.post(pushUrl, {
                        Name: className,
                        DepartID: departId
                    }, function (rescode) {
                        if (rescode === 99) {
                            classDs();
                        } else {
                            alert('保存院系信息失败.');
                        }
                    });
                }
            });

        });

    </script>
</body>
</html>