<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!--DATEPICKER START-->
    <link rel="stylesheet" href="../resource/bootstrap-datepicker-master/dist/css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../resource/bootstrap-datepicker-master/dist/css/bootstrap-datepicker.standalone.css" />
    <link rel="stylesheet" href="../resource/bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.min.css">
    <!--DATEPICKER END-->
    <!--MY STYLE-->
    <link rel="stylesheet" href="../resource/css/leftBat.css">
    <link rel="stylesheet" href="../resource/css/index.css">
    <script src="../resource/js/jquery-1.11.2.js"></script>
    <script src="../../../assets/local/scripts/underscore-min.js"></script>
    <script src="../resource/js/pointersoffices.js"></script>
    <script src="../resource/js/moment.js"></script>
    <script src="../resource/js/showOrHidden.js"></script>
    <link rel="stylesheet" href="../resource/zTree_v3-master/css/zTreeStyle/style.css">
    <link rel="stylesheet" href="../resource/zTree_v3-master/css/metroStyle/metroStyle.css">
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="../../../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN THEME STYLES -->
    <link href="../../../assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css" />
    <link href="../../../assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link id="style_color" href="../../../assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" />
    <link href="../../../assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css" />
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="../favicon.ico" />
    <!--非框架中的样式-->
    <link rel="stylesheet" href="../bank-branch-resource/css/lib/date/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../bank-branch-resource/css/lib/date/bootstrap-datepicker.standalone.css" />
    <link rel="stylesheet" href="../bank-branch-resource/css/common.css" />
    <link rel="stylesheet" href="../bank-branch-resource/css/huanjingjiance/EnvironmentallyMonitorBranch.css" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
<!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
<!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
<!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
<!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
<!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
<!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
<body class="page-header-fixed page-quick-sidebar-over-content">
    <!-- BEGIN HEADER -->
    <div class="page-header navbar navbar-fixed-top">
        <!-- BEGIN HEADER INNER -->
        <div class="page-header-inner">
            <!-- BEGIN LOGO -->
            <div class="page-logo">
                <a href="./EnergyQueryTotalData.html">
                    <img src="../../../assets/local/img/hq3-small.png" alt="logo" class="logo-default" />
                </a>
                <div class="menu-toggler sidebar-toggler hide">
                    <!-- DOC: Remove the above "hide" to enable the sidebar toggler button on header -->
                </div>
            </div>
            <!-- END LOGO -->
            <!-- BEGIN RESPONSIVE MENU TOGGLER -->
            <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
            </a>
            <!-- END RESPONSIVE MENU TOGGLER -->
            <!-- BEGIN TOP NAVIGATION MENU -->
            <div class="totalTitle"></div>
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    <!-- BEGIN NOTIFICATION DROPDOWN -->
                    <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                    <li class="dropdown dropdown-extended dropdown-notification" id="header_notification_bar">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                            <i class="icon-bell"></i>
                            <span class="badge badge-danger">
                                0
                            </span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="external">
                                <h3><span class="bold">0 </span> 当日报警</h3>
                                <a href="../baojingyujing/warningAlarm-3.html">查看详细</a>
                            </li>
                        </ul>
                    </li>
                    <!-- END NOTIFICATION DROPDOWN -->
                    <!-- BEGIN USER LOGIN DROPDOWN -->
                    <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                    <li class="dropdown dropdown-user">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                            <span class="username username-hide-on-mobile">
                            </span>
                            <i class="fa fa-angle-down"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-default">
                            <li>
                                <a class="logout-page" href="../login.html">
                                    <i class="icon-key"></i> 退出
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- END USER LOGIN DROPDOWN -->
                    <!-- BEGIN QUICK SIDEBAR TOGGLER -->
                    <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                    <!-- END QUICK SIDEBAR TOGGLER -->
                </ul>
            </div>
            <!-- END TOP NAVIGATION MENU -->
        </div>
        <!-- END HEADER INNER -->
    </div>
    <!-- END HEADER -->
    <div class="clearfix">
    </div>
    <!-- BEGIN CONTAINER -->
    <div class="page-container">
        <!-- BEGIN SIDEBAR -->
        <div class="page-sidebar-wrapper">
            <!-- DOC: Set data-auto-scroll="false" to disable the sidebar from auto scrolling/focusing -->
            <!-- DOC: Change data-auto-speed="200" to adjust the sub menu slide up/down speed -->
            <div class="page-sidebar navbar-collapse collapse">
                <!-- BEGIN SIDEBAR MENU -->
                <!-- DOC: Apply "page-sidebar-menu-light" class right after "page-sidebar-menu" to enable light sidebar menu style(without borders) -->
                <!-- DOC: Apply "page-sidebar-menu-hover-submenu" class right after "page-sidebar-menu" to enable hoverable(hover vs accordion) sub menu mode -->
                <!-- DOC: Apply "page-sidebar-menu-closed" class right after "page-sidebar-menu" to collapse("page-sidebar-closed" class must be applied to the body element) the sidebar sub menu mode -->
                <!-- DOC: Set data-auto-scroll="false" to disable the sidebar from auto scrolling/focusing -->
                <!-- DOC: Set data-keep-expand="true" to keep the submenues expanded -->
                <!-- DOC: Set data-auto-speed="200" to adjust the sub menu slide up/down speed -->
                <ul class="page-sidebar-menu" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
                    <!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
                    <li class="sidebar-toggler-wrapper">
                        <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
                        <div class="sidebar-toggler">
                        </div>
                        <!-- END SIDEBAR TOGGLER BUTTON -->
                    </li>
                </ul>
                <!-- END SIDEBAR MENU -->
            </div>
        </div>
        <!-- END SIDEBAR -->
        <!-- BEGIN CONTENT -->
        <div class="page-content-wrapper">
            <div class="page-content">
                <!-- BEGIN STYLE CUSTOMIZER -->
                <div class="theme-panel hidden-xs hidden-sm">
                    <div class="toggler">
                    </div>
                    <div class="toggler-close">
                    </div>
                    <div class="theme-options">
                        <div class="theme-option theme-colors clearfix">
                            <span>
                                配色
                            </span>
                            <ul>
                                <li class="color-default current tooltips" data-style="default" data-container="body" data-original-title="默认">
                                </li>
                                <li class="color-darkblue tooltips" data-style="darkblue" data-container="body" data-original-title="蓝黑">
                                </li>
                                <li class="color-blue tooltips" data-style="blue" data-container="body" data-original-title="蓝色">
                                </li>
                                <li class="color-grey tooltips" data-style="grey" data-container="body" data-original-title="灰色">
                                </li>
                            </ul>
                        </div>
                        <div class="theme-option">
                            <span>
                                布局
                            </span>
                            <select class="layout-option form-control input-sm">
                                <option value="fluid" selected="selected">平铺</option>
                                <option value="boxed">盒式</option>
                            </select>
                        </div>

                        <div class="theme-option">
                            <span>
                                侧边菜单
                            </span>
                            <select class="sidebar-menu-option form-control input-sm">
                                <option value="accordion" selected="selected">手风琴式</option>
                                <option value="hover">鼠标悬停</option>
                            </select>
                        </div>
                        <div class="theme-option">
                            <span>
                                侧边位置
                            </span>
                            <select class="sidebar-pos-option form-control input-sm">
                                <option value="left" selected="selected">左</option>
                                <option value="right">右</option>
                            </select>
                        </div>
                        <div class="theme-option">
                            <span>
                                底部
                            </span>
                            <select class="page-footer-option form-control input-sm">
                                <option value="fixed">位置固定</option>
                                <option value="default" selected="selected">默认</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- END STYLE CUSTOMIZER -->
                <!-- BEGIN PAGE HEADER-->
                <h3 class="page-title"></h3>
                <div class="page-bar">
                    <ul class="page-breadcrumb">
                        <li>
                            <i class="fa fa-home"></i>

                            <i class="fa fa-angle-right"></i>
                        </li>
                    </ul>
                    <div class="showOrHidden"></div>
                    <div class="page-toolbar">
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- BEGIN PAGE CONTENT-->
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="total-warp">
                            <!--background-color:#ffd966;-->
                            <div class="row margin-top-10" style="background-color:#343959;padding:3px;margin-right: 0px;margin-left: 0px;">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div style="float:left;line-height:35px;margin-left:0px;color:#FFF;">位置 :</div>
                                    <div style="float:left;width:200px;margin-left:5px;">
                                        <select id="serviceInfoSelect" class="table-group-action-input form-control"></select>
                                    </div>
                                    <div style="float:left;line-height:35px;margin-left:35px;color:#FFF;">时间 :</div>
                                    <div style="float:left;margin-left:5px;">
                                        <select style="margin-right:10px;" id="datetimeInfoSelect" class="datatimeblock table-group-action-input form-control">
                                            <option value="1" selected>今天</option>
                                            <option value="2">昨天</option>
                                            <option value="3">最近7天</option>
                                            <option class="custom-time" value="4">自定义</option>
                                            <input class="show-date" style="" />
                                        </select>
                                    </div>
                                    <a id="emqBtn" class="btn btn-default top-btn pull-left" style="margin-left:20px;">查询数据</a>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="row margin-top-10">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="portlet light bordered">
                                        <div class="portlet-title" style="margin-right:0px !important;">
                                            <div class="caption">
                                                <i class="icon-bar-chart font-green-sharp hide"></i>
                                                <span class="caption-subject font-green-sharp bold uppercase">实时数据</span>
                                                <span class="caption-helper">全部监测因子的实时数</span>
                                                <span class="caption-helper" id="instdatadt"></span>
                                            </div>
                                            <div class="actions">
                                                <div class="btn-group btn-group-devided" data-toggle="buttons">
                                                    <label class="btn btn-transparent">

                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <div id="instdatapanel" class="row">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="portlet light bordered">
                                        <div class="portlet-title" style="margin-right:0px !important;">
                                            <div class="caption">
                                                <i class="icon-bar-chart font-green-sharp hide"></i>
                                                <span class="caption-subject font-green-sharp bold uppercase">历史数据</span>
                                                <span class="caption-helper">监测因子历史数据</span>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <div class="row" id="hsyrow"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END QUICK SIDEBAR -->
            </div>
        </div>
        <!--自定义时间-->
        <div class='modal fade' id='choose-date' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true' data-backdrop="static">
            <div class='modal-dialog' style='width:30%;min-width:400px;margin:15% auto'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
                        <div class="add-title" style="font-size:24px;line-height:40px;padding:10px;margin-bottom:20px">自定义时间</div>
                        <div class="row">

                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 inner-input">
                                <label for="" class="input-label" style="width:95px;">开始日期：</label>

                                <div class="add-input-block">
                                    <input type="text" class="add-input chooseDate chooseDates" value="" placeholder="选择时间">
                                </div>

                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 inner-input">
                                <label for="" class="input-label" style="width:95px;">结束日期：</label>

                                <div class="add-input-block">
                                    <input type="text" class="add-input chooseDate chooseDates" value="" placeholder="选择时间">
                                </div>

                            </div>
                        </div>
                        <div class='modal-footer'>
                            <button type='button' class='btn btn-primary top-btn'>确定</button>
                            <button type='button' class='btn btn-default' data-dismiss='modal'>关闭</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--自定义弹窗-->
        <div class='modal fade' id='my-alert' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
            <div class='modal-dialog' style='width:600px;margin:15% auto'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <h3 style="margin-bottom:18px">提示</h3>
                        <p style="font-size:20px"> <b style="color:red"></b> </p>

                        <div class='modal-footer' style="border:none">

                            <button type='button' class='btn btn-primary top-btn' data-dismiss='modal'>确定</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div class="page-footer">
        <div class="page-footer-inner">
            2016 &copy; Huaqin.
        </div>
        <div class="scroll-to-top">
            <i class="icon-arrow-up"></i>
        </div>
    </div>

    <!-- END FOOTER -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
    <!-- BEGIN CORE PLUGINS -->
    <!--[if lt IE 9]>
    <script src="../../../assets/global/plugins/respond.min.js"></script>
    <script src="../../../assets/global/plugins/excanvas.min.js"></script>
    <![endif]-->
    <script src="../../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
    <!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="../../../assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap/js/bootstrap.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="../../../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <script src="../../../assets/global/scripts/metronic.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
    <script src="../../../assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
    <script src="../../../assets/local/scripts/BEE.js"></script>
    <script src="../resource/zTree_v3-master/js/jquery.ztree.all.js"></script>
    <script src="../resource/zTree_v3-master/js/jquery.ztree.exhide.js"></script>
    <script src="../bank-branch-resource/js/lib/bootstrap-datepicker.js"></script>
    <script src="../bank-branch-resource/js/lib/moment.min.js"></script>
    <script src="../bank-branch-resource/js/lib/echarts.common.min.js" rel="stylesheet"></script>
    <script src="../bank-branch-resource/js/common.js"></script>
    <script>
        jQuery(document).ready(function () {
            Metronic.init(); // init metronic core components
            BEE.init();
            Layout.init(); // init current layout
            Demo.init(); // init demo features
        });
    </script>
    <script type="text/javascript">

        //总支路数据(对象列表)
        var serviceInfos;

        //监测因子数组(查询所有监测因子的实时数据)
        var cdataIds;

        //支路因子数组(查询所有支路因子的历史数据)
        var serviceIds;

        //选中的楼宇
        var pointerId;

        $(document).ready(function () {

            var eprs = JSON.parse(sessionStorage.getItem('enterPriseList'));
            var eprId = eprs[0].enterpriseID;//支行ID
            var eprNt = eprs[0].eprName;//支行名称

            //获取支路信息数据
            getServiceInfoDs(eprId);

            //改变位置(SELECTION)
            $('select#serviceInfoSelect').change(function () {
                if (serviceInfos != undefined) {
                    getServiceNowDs();
                }
            });

            //查询实时和历史数据
            $('#emqBtn').on('click', function () {
                getServiceNowDs();
            });

        });

        //获取支路位置数据
        function getServiceInfoDs(eprId) {
            var prms = {
                eprId: eprId
            };
            var url = IP + "/EnvironmentallyMonitor/GetEnvironMonitorServiceObjectDs";
            $.ajax({
                type: 'GET',
                url: url,
                data: prms,
                async: false,
                success: function (res) {
                    if (res.length > 0) {
                        //支路信息位置
                        $('#serviceInfoSelect').html();
                        $('#serviceInfoSelect').find('option').remove();
                        $('#serviceInfoSelect').empty();
                        for (var i = 0; i < res.length; i++) {
                            $('#serviceInfoSelect').append($("<option value=\"" + res[i].serviceInfoID + "\">" + res[i].location + "</option>"));
                        }
                        var idxEpr = 0;//默认选择第一项
                        $('#serviceInfoSelect option:eq(0)').attr('selected', 'selected');
                        serviceInfos = res;
                        //获取监测因子试试数据
                        getServiceNowDs();
                    }
                    else {
                        $('#serviceInfoSelect').html();
                        $('#serviceInfoSelect').find('option').remove();
                        $('#serviceInfoSelect').empty();
                        $('#cdataIdSelect').html();
                        $('#cdataIdSelect').find('option').remove();
                        $('#cdataIdSelect').empty();
                    }
                }
            });
        }

        //根据支路位置获取监测因子数据
        var getCDataIDs = function (infoID) {
            var whereprs = _.where(serviceInfos, { serviceInfoID: infoID });
            if (whereprs.length > 0) {
                cdataIds = [];
                var cds = whereprs[0].environMonitorInsDataObjectDs;
                for (var i = 0; i < cds.length; i++) {
                    if (i === 0) {
                        pointerId = cds[0].pointerID;
                    }
                    cdataIds.push(cds[i].cDataID.toString());
                }
            }
            return cdataIds;
        }

        //根据支路位置获取支路因子数据
        var getServiceIDs = function (infoID) {
            var whereprs = _.where(serviceInfos, { serviceInfoID: infoID });
            if (whereprs.length > 0) {
                serviceIds = [];
                var cds = whereprs[0].environMonitorInsDataObjectDs;
                for (var i = 0; i < cds.length; i++) {
                    if (i === 0) {
                        pointerId = cds[0].pointerID;
                    }
                    serviceIds.push(cds[i].serviceID.toString());
                }
            }
            return serviceIds;
        }

        //获取监测因子实时数据
        function getServiceNowDs() {
            var infoID = $('#serviceInfoSelect').val();//位置类型
            var dType = $('#datetimeInfoSelect').val();//时间类型
            var cdataIdArys = getCDataIDs(infoID);
            var pId = pointerId;
            if (dType == undefined || cdataIdArys == undefined || pId == undefined) {
                myAlter('请选择正确的参数查询数据');
                return false;
            }
            if (cdataIdArys.length == 0) {
                myAlter('请选择正确的参数查询数据');
                return false;
            }
            var startDT = '-1';
            var endDT = '-1';
            if (dType == 4) {
                var dateString = $('.show-date').val();
                startDT = dateString.split('——')[0];
                endDT = dateString.split('——')[1];
            }
            var parms = {
                PointerID: pId,
                CDataIDs: cdataIdArys,
                ServiceID: '',
                DType: dType,
                StartDT: startDT,
                CloseDT: endDT
            };
            var url = IP + "/EnvironmentallyMonitor/GetEnvironMonitorDs";
            $.ajax({
                type: 'POST',
                url: url,
                data: parms,
                async: false,
                success: function (res) {
                    var insts = res.environMonitorInsDs;
                    if (insts.length > 0) {
                        $('#instdatadt').html(insts[0].dataDate);
                    }
                    //绘制实时数据
                    drawcdatarc(insts);
                    //获取历史数据
                    getServiceHistoryDs(infoID, pId, dType, startDT, endDT);
                }
            });
        }

        //获取历史数据
        function getServiceHistoryDs(infoID, pId, dType, startDT, endDT) {
            var serviceIdArys = getServiceIDs(infoID);
            var parms = {
                PointerID: pId,
                ServiceIDs: serviceIdArys,
                DType: dType,
                StartDT: startDT,
                CloseDT: endDT
            };
            var url = IP + "/EVNMo/GetEnvironHistoryByServiceIDs";
            $.ajax({
                type: 'POST',
                url: url,
                data: parms,
                async: false,
                success: function (res) {
                    if (res.code === 0) {
                        var xys = res.xys;
                        $('#hsyrow').html();
                        var table = '';
                        for (var i = 0; i < xys.length; i++) {
                            var tableNt = 'table_' + (i + 0);
                            table += "<div class='col-lg-6 col-md-6 col-sm-12 col-xs-12'>"
                                  + '<div id=' + tableNt + ' style="width:100%;height:350px;margin:5px;margin-bottom:50px;"></div>'
                                  + '</div>';
                        }
                        $('#hsyrow').html(table);
                        for (var i = 0; i < xys.length; i++) {
                            var tableNt = 'table_' + (i + 0);
                            var lg = xys[i].lg;
                            var xs = xys[i].xs;
                            var ys = xys[i].ys;
                            drawhsycw(tableNt, lg, xs, ys);
                        }
                    } else if (res.code === -1) {
                    } else {
                    }
                }
            });
        }

        var mycv;

        window.onresize = function () {
            if (mycv) {
                mycv.resize();
            }
        };

        //绘制历史数据曲线
        function drawhsycw(tableNt, lgnt, xs, ys) {
            var xAs = xs;
            var yds = ys;
            mycv = echarts.init(document.getElementById(tableNt));
            option = {
                tooltip: {
                    trigger: 'axis'
                },
                grid: {
                    left: '5%',
                    right: '5%'
                },
                legend: {
                    data: [lgnt]
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    axisLabel: {
                        rotate: 30,
                        margin: 20
                    },
                    data: xAs
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                series: [
                    {
                        name: lgnt,
                        type: 'line',
                        data: yds
                    }
                ]
            };
            mycv.setOption(option);
        }

        //绘制实时数据
        function drawcdatarc(insts) {
            $('#instdatapanel').empty();
            for (var i = 0; i < insts.length; i++) {
                var instmodel = insts[i];
                var inst_data = instmodel.data;
                var inst_misc = instmodel.misc;
                var inst_cnamet = instmodel.cNameT;
                var table = ' <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12"> '
                    + '<div style="text-align:center;margin:5px;padding:10px;border-radius:2px !important;background-color:#f7f7f7;">'
                    + '<h3>' + inst_data + '<span style="font-size:13px;margin-left:5px;">' + inst_misc + '</span></h3>'
                    + '<p style="margin:5px;"><h5>' + inst_cnamet + '</h5></p>'
                    + '</div>'
                    + '</div>';
                $('#instdatapanel').append(table);
            }
        }

        //关闭时间弹窗时
        $('#choose-date .btn-default').on('click', function () {

            $('.datatimeblock').val('1');

            $('.show-date').css({
                display: 'none'
            })

        });

        //关闭时间弹窗(选择)
        $('#choose-date .close').on('click', function () {

            $('.datatimeblock').val('1');

            $('.show-date').css({
                display: 'none'
            })

        });

        //选定时间后
        $('#choose-date .btn-primary').on('click', function () {

            if (!checkedNull('#choose-date')) {
                return false;
            }
            var txt1 = $('#choose-date .add-input').eq(0).val();
            var txt2 = $('#choose-date .add-input').eq(1).val();

            var nowDate = getNewDate();

            //if(CompareDate(txt2,nowDate) == true){
            //    myAlter('结束日期不能大于当前日期');
            //    getFocus1( $(this).parents('.modal-header').find('.add-input').eq(1));
            //
            //    return false;
            //};


            if (CompareDate(txt2, txt1) == false) {
                myAlter('结束日期必须大于开始日期');
                getFocus1($(this).parents('.modal-header').find('.add-input').eq(1));

                return false;
            };

            var date = txt1 + '——' + txt2;

            //console.log(date);

            $('.show-date').css({
                display: 'inline-block'
            });

            $('.show-date').val(date);

            $('#choose-date').modal('hide');

        });

        //打开时间弹窗时
        $('.show-date').on('focus', function () {
            $('#choose-date').modal('show');
            $('#choose-date input').val('');
        });

    </script>
    <!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
